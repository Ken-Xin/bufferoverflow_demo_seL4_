<?xml version="1.0" encoding="UTF-8"?>
<system>
    <!-- 共有メモリ領域 -->
    <memory_region name="shared_memory" size="0x200000" phys_addr="0x40000000" />
    <memory_region name="log_buffer" size="0x100000" phys_addr="0x50000000" />
    
    <!-- 正常なサーバー Protection Domain -->
    <protection_domain name="safe_server" priority="100">
        <program_image path="safe_server.elf" />
        <map mr="shared_memory" vaddr="0x4000000" perms="rw" cached="true" 
             setvar_vaddr="shared_mem_vaddr" />
    </protection_domain>
    
    <!-- バッファオーバーフロー脆弱性を持つPD -->
    <protection_domain name="vulnerable_pd" priority="50">
        <program_image path="vulnerable_pd.elf" />
    </protection_domain>
    
    <!-- ロガー Protection Domain -->
    <protection_domain name="logger" priority="150">
        <program_image path="logger.elf" />
        <map mr="log_buffer" vaddr="0x5000000" perms="rw" cached="true" 
             setvar_vaddr="log_buffer_vaddr" setvar_size="log_buffer_size" />
    </protection_domain>
    
    <!-- 攻撃者シミュレーター -->
    <protection_domain name="attacker" priority="40">
        <program_image path="attacker.elf" />
    </protection_domain>
    
    <!-- チャネル設定 -->
    <channel>
        <end pd="attacker" id="1" />
        <end pd="vulnerable_pd" id="1" />
    </channel>
    
    <channel>
        <end pd="safe_server" id="1" />
        <end pd="logger" id="1" />
    </channel>
    
    <channel>
        <end pd="vulnerable_pd" id="2" />
        <end pd="logger" id="2" />
    </channel>
    
    <channel>
        <end pd="attacker" id="3" />
        <end pd="logger" id="3" />
    </channel>
</system>
